{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'accueil_utilisateur/css/tailwindcss-colors.css' %}">
    <link rel="stylesheet" href="{% static 'accueil_utilisateur/css/styles.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"/>
    <title>Chat</title>
</head>
<body>
<style>
#story-section {
    display: flex;
    overflow-x: auto;
    padding: 10px 5px;
    border-bottom: 1px solid #ccc;
    background-color: #f8f9fa;
    margin-top: 100px;
}

.story {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin-right: 10px;
    position: relative;
    overflow: hidden;
    border: 2px solid #007bff;
}

.story img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.story-indicator {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 20px;
    background-color: red;
    border-radius: 50%;
}

    .loading {
        position: relative;
        display: inline-block;
    }
    .loading::after {
        content: 'C';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 24px;
        height: 24px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid blue;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    .conversation{
    {% if request.user.theme_sombre %}
        background-color: rgb(22 24 24);
    {% else %}
        background-color: rgb(255, 255, 255);
    {% endif %}
    }
    .blurred {
        backdrop-filter: blur(5px);
    }


    button {
        background-color: #fff;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        color: #007bff;
    }

    #photo-icon {
        cursor: pointer;
        width: 40px;
        height: 40px;
        transition: opacity 0.3s ease;
        font-size: 35px;
    }
    #publication-action-icon {
        cursor: pointer;
        width: 40px;
        height: 40px;
        transition: opacity 0.3s ease;
        font-size: 40px;
    }
    #photo-icon:hover {
        opacity: 0.7;
    }

    #publish-form {
        position: fixed;
        width: 100%;
        background-color: #fff;
        border: 1px solid #dddfe2;
        border-radius: 8px;
        padding: 16px;
        z-index: 100;
        overflow-y: auto;
        max-height: 700px;
    }

    #publish-form label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;

    }

    #publish-form input[type="text"],
    #publish-form input[type="file"] {
        width: calc(100% - 20px);
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    #publish-form button {
        width: 100%;
        padding: 10px;
        background-color: #28a745;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #publish-form button:hover {
        background-color: #218838;
    }

    #image-editor img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .publication {
        background-color: #fff;
        border-radius: 5px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    {% if request.user.theme_sombre %}
        background-color:#020101;
        color: white;
    {% else %}
        background-color: rgb(255, 255, 255);
    {% endif %}

    }
    .navbar{
    {% if request.user.theme_sombre %}
        background-color:#020101;
        color: white;
    {% else %}
        background-color: rgb(255, 255, 255);
    {% endif %}
    }

    .publication-header {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .user-profile {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }

    .user-info {
        display: flex;
        flex-direction: column;
    }
    .user-name {
        margin: 0;
        font-weight: bold;
    }

    .publication-time {
        margin: 0;
        font-size: 0.9rem;
        color: gray;
    }

    /* Contenu de la publication */
    .publication-content {
        margin-bottom: 10px;
    }

    .publication-image {
        width: 100%;
        border-radius: 5px;
        margin-top: 10px;
    }

    .publication-actions {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .action-button {
        border: none;
        background-color: #f0f2f5;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1.5rem;
    }

    .action-button:hover {
        background-color: #e9ebee;
    }

    /* Section des commentaires */
    .comments-section {
        align-items: center;
        display: none;
        border-top: 1px solid #ccc;
        padding-top: 10px;
        position: relative;
    }

    .commentaire-form {
        display: flex;
        justify-content: space-between;
        position: sticky;
        bottom: 0;
        padding: 10px;
        background-color: #f9f9f9;
        border-top: 1px solid #cccccc;
        z-index: 1;
        box-sizing: border-box;

    }

    .commentaire-input {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 5px;
        width: 100%;
    }

    .commentaire-form button {
        border: none;
        background-color: #007bff;
        color: #fff;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
    }

    .action-button.liked i {
        color: #ff4d4d;
    }
    .comment-count {
        font-size: 1rem;
        color: #888;
        margin-left: 5px;
    }
    .likes-container {
        display: flex;
        align-items: center;
    }
    .comment-count-container {
        display: flex;
        align-items: center;
        justify-content: space-between; /
    }

    .likes-container button,
    .likes-container span {
        margin-right: 5px;
    }
    .comment-count-container button,
    .comment-count-container span {
        margin-right: 5px;
    }
    .comments-container {
        width: 100%;
        border: 1px solid #cccccc;
        padding: 10px;
        margin-top: 10px;
        background-color: #dcd9d9;
        border-radius: 5px;
    }

    @media (max-width: 480px) {
        .commentaire-form {
            width: 100%;
        }
        .comments-container {
            width: 100%;
        }
    }




    .content-message-unread i {
        color: #007bff;
        font-size: 20px;
    }
    #publicationSection {
        position: fixed;
        width: 100%;
        background-color: #fff;
        border: 1px solid #dddfe2;
        border-radius: 8px;
        padding: 16px;
        margin-top: 16px;
        z-index: 100;
        overflow-x: auto;

    }

    #publicationForm {
        margin-bottom: 16px;
        overflow-y: auto;
        max-height: 400px;
    }

    #texteInput {
        width: 100%;
        padding: 12px;
        border: 1px solid #dddfe2;
        border-radius: 8px;
        margin-bottom: 12px;
        resize: none;
    }

    #preview {
        border-top: 1px solid #dddfe2;
        padding-top: 16px;
    }

    #textePreview {
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 12px;
        min-height: 200px;
        max-height: 200px;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow-x: hidden;
    }

    #publicationButton {
        background-color: #1877f2;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        cursor: pointer;
        width: 100%;
        transition: background-color 0.3s ease;
    }

    #publicationButton:hover {
        background-color: #166fe5;
    }


</style>
{% include 'bottom_bar.html' %}
<div id="story-section">
    <div class="story">
        <img src="{% static 'chater_logo.png' %}" alt="Story image">
        <div class="story-indicator"></div>
    </div>
     <div class="story">
        <img src="{% static 'font_decran.png' %}" alt="Story image">
        <div class="story-indicator"></div>
    </div>
</div>

<div id="publicationSection" style="display: none;">
    <i onclick="" style="font-size: 30px" class="bi bi-x-circle-fill"></i>
    <form class="publier_text_form" id="publicationForm" action="{% url 'Utilisateur:creer_publication' %}" method="post">
        {% csrf_token %}
        <div id="emojiSection" style="position: absolute; right: 0; margin-right: 20px">
            <button id="emojiButton" type="button" style="font-size: 40px; margin-top: 20px">üòä</button>
            <div id="emojiPanel" style="display: none;">
                <span onclick="insertEmoji('üòä')">üòä</span>
                <span onclick="insertEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
                <span onclick="insertEmoji('üëç')">üëç</span>
                <span onclick="insertEmoji('üòü')">üòü</span>
                <span onclick="insertEmoji('üòÖ')">üòÖ</span>
                <span onclick="insertEmoji('üò∞')">üò∞</span>
            </div>
        </div>
        <textarea id="texteInput" name="texte" placeholder="√âcrivez votre publication ici"></textarea>
        <input type="hidden" id="couleurFondHidden" name="couleur_fond" value="">
        <div id="backgroundOptions" style="overflow-x: auto; white-space: nowrap;">
            <div class="backgroundOption" data-value="linear-gradient(to bottom, rgba(255,128,255,0.5), rgba(0,0,128,0.5))" style="background-image: linear-gradient(to bottom, rgba(255,128,255,0.5), rgba(0,0,128,0.5)); border-radius: 50%; width: 50px; height:  50px; display: inline-block; margin-right: 10px;"></div>
            <div class="backgroundOption" data-value="linear-gradient(to bottom, rgba(128,0,128,0.5), rgba(0,0,128,0.5))" style="background-image: linear-gradient(to bottom, rgba(128,0,128,0.5), rgba(0,0,128,0.5)); border-radius: 50%; width: 50px; height:  50px; display: inline-block; margin-right: 10px;"></div>
            <div class="backgroundOption" data-value="linear-gradient(to bottom, rgba(0,128,0,0.5), rgba(0,0,128,0.5))" style="background-image: linear-gradient(to bottom, rgba(0,128,0,0.5), rgba(0,0,128,0.5)); border-radius: 50%; width: 50px; height:  50px; display: inline-block; margin-right: 10px;"></div>
            <div class="backgroundOption" data-value="linear-gradient(to bottom, rgba(255,105,180,0.5), rgba(255,165,0,0.5))" style="background-image: linear-gradient(to bottom, rgba(255,105,180,0.5), rgba(255,165,0,0.5)); border-radius: 50%; width: 50px; height:  50px; display: inline-block; margin-right: 10px;"> </div>
            <div class="backgroundOption" data-value="linear-gradient(90deg, #020024 0%, #090979 35%, #00d4ff 100%)" style="background-image: linear-gradient(90deg, #020024 0%, #090979 35%, #00d4ff 100%);; border-radius: 50%; width: 50px; height:  50px; display: inline-block; margin-right: 10px;"> </div>
            <div class="backgroundOption" data-value="url('{% static 'bacground image/smile.png' %}')" style="background-image: url('{% static 'bacground image/smile.png' %}'); border-radius: 50%; width: 50px; height:  50px; display: inline-block; margin-right: 10px;'"> </div>
        </div>
        <h3>Aper√ßu</h3>
        <div id="preview">
            <div id="textePreview"></div>
        </div>
        <button id="publicationButton" type="submit">Publier</button>
    </form>
</div>
<form  id="publish-form" style="display: none; ">
    <i  style="font-size: 30px" class="bi bi-x-circle-fill" onclick="closePublishForm()"></i>
    <label for="titre">Ajouter une legende:</label>
    <input type="text" id="titre_photo" name="titre">
    <label for="photo_file">Changer l'image: <i style="font-size: 30px" class="bi bi-camera"></i></label>
    <input hidden="hidden" type="file" id="photo_file" name="photo_file" accept="image/*" required>

    <div id="image-editor">
        <img id="image-to-edit" alt="Pr√©visualisation">
    </div>
    <button id="publishFormButton" type="submit">Publier</button>
</form>
<div class="conversation active" id="Acceuil" style="margin-top: 60px; min-width: 100%">
    <nav class="navbar">
        <i style="color: #7906a5;" id="publication-action-icon" class="bi bi-fonts"></i>
        <i style="color: #7906a5; margin-left: 10px" id="photo-icon" class="bi bi-patch-plus"></i>
        <div class="profile-dropdown" style="margin-left: auto;">
            <div onclick="toggle()" class="profile-dropdown-btn">
                <div class="profile-img">
                    <img class="profile-img" style="" src="{{ request.user.image.url }}">
                </div>
            </div>

            <ul class="profile-dropdown-list">
                <li class="profile-dropdown-list-item">
                    <a href="{% url 'Utilisateur:parametre' %}">
                        <i class="fa-solid fa-sliders"></i>
                        Parametre
                    </a>
                </li>
                <hr />
                <li class="profile-dropdown-list-item">
                    <a href="#" onclick="deconnexion();">
                        <i class="fa-solid fa-arrow-right-from-bracket"></i>
                        D√©connexion
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    {% if Publication_alls  %}
        {% for photo in Publication_alls %}
            <div class="publication"  data-post-id="{{ publication.id }}"  id="publicationIdPub">
                <div class="publication-header">
                    <img src="{{ photo.utilisateur.image.url }}" alt="Profil de l'utilisateur" class="user-profile">
                    <div class="user-info">
                        <p class="user-name">{{ photo.utilisateur.nom }} {{ photo.utilisateur.prenom }}  <img style="width: 20px; margin-top: 10px" src="{% static 'badge.png' %}" alt="Badge certifi√©"></p>
                        <p class="publication-time"><i class="bi bi-globe-americas"></i> Il y a {{ photo.date_pub }}</p>
                    </div>
                </div>
                {% if photo.photo_file  %}
                    <div class="publication-content">
                        {% if photo.titre  %}
                            <p>{{ photo.titre }}</p>
                        {% endif  %}
                            <img src="{{ photo.photo_file.url }}" alt="Image de la publication" class="publication-image">
                    </div>
                {% else  %}
                    <div class="publication-content" style=" min-height: 400px; display: flex; justify-content: center; align-items: center; background-image:{{ photo.couleur_fond }} ">
                        <div class="publication-content" style="color: white">
                            {{ photo.contenu }}
                        </div>
                    </div>
                {% endif  %}
                <div class="row publication-actions">
                    <div class="col-4 likes-container" style="font-size: 11px; padding-left: 20px;">
                        <button class="action-button" id="like-button" data-publication-id="{{ photo.id }}">
                            <i class="bi bi-heart-fill"></i>
                        </button>
                        <span class="likes-count">
                                    {% for key, value in publication_likes.items %}
                                        {% if key == photo.id %}
                                            {{ value }}
                                        {% endif %}
                                    {% endfor %}
                                </span> likes
                    </div>
                    <div class="col-4 comment-count-container" style="font-size: 11px; padding-right: 20px;">
                        <button class="action-button" id="comment-button" data-publicationafficher-id="{{ photo.id }}"><i class="bi bi-chat"></i></button>
                        <span class="comment-count" id="comment-count-{{ photo.id }}"></span> commentaires
                    </div>
                    <div class="col-4 comment-count-container" style="font-size: 10px; padding-right: 30px; margin-right: 10px;">
                        <span class="comment-count">15,42k</span> Vues
                    </div>
                </div>

            <div class="comments-section" id="comments-section-{{ photo.id }}" data-url="{% url 'Utilisateur:get_comments' photo.id %}" style="display: block; overflow-y: auto; overflow-x: hidden; max-height: 300px">
                <div class="comments-container" id="comments-container-{{ photo.id }}">
                    <!-- Les commentaires seront ajout√©s ici -->
                </div>
                <form class="commentaire-form" id="commentaire-form-{{ photo.id }}">
                    {% csrf_token %}
                    <input type="text" class="commentaire-input" id="commentaire-input-{{ photo.id }}" placeholder="√âcrivez un commentaire...">
                    <button type="submit" data-publications-id="{{ photo.id }}">‚ñ∂Ô∏è</button>
                </form>
            </div>

            </div>
        {% endfor %}
    {% endif %}
</div>

{#Publication#}
<script>
    var publishForm = document.getElementById('publish-form');
    var imageElement = document.getElementById('image-to-edit');
    const blurContainer = document.getElementById('Acceuil');

    document.querySelector('#photo_file').addEventListener('change', function(event) {
        var reader = new FileReader();
        reader.onload = function() {
            imageElement.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    });

    // Soumettre l'image charg√©e
    publishForm.addEventListener('submit', function(event) {
        event.preventDefault();
        var fileInput = document.getElementById('photo_file');
        if (fileInput.files.length > 0) {
            var formData = new FormData();
            formData.append('photo_file', fileInput.files[0]);
            formData.append('titre', document.getElementById('titre_photo').value);

            fetch("{% url 'Utilisateur:publier_photo' %}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = data.redirect_url; // Redirect to the URL provided by the server
                    } else {
                        console.log('Erreur lors de la publication de l\'image : ' + data.errors);
                    }
                })
                .catch(error => {
                    console.error('Erreur lors de la requ√™te AJAX :', error);
                    console.log('Une erreur s\'est produite lors de la soumission du formulaire.');
                });
        } else {
            alert('Veuillez s√©lectionner une image.');
        }
    });


    function closePublishForm() {
        var publishForm = document.getElementById('publish-form');
        var blurContainer = document.getElementById('Acceuil');
        publishForm.style.display = "none";
        blurContainer.classList.remove('blurred');
        imageElement.src = "";
    }

</script>

<script>
    var photoIcon = document.getElementById('photo-icon');
    var photoInput = document.getElementById('photo_file');
    var publishForm = document.getElementById('publish-form');
    photoIcon.addEventListener('click', function() {
        photoInput.click();
        publishForm.style.display = 'block';
    });
</script>
{#Liker & commenter &afficher_commentaire#}
<script>
    document.querySelectorAll('#like-button').forEach(button => {
        button.addEventListener('click', function() {
            const publicationId = this.getAttribute('data-publication-id');
            fetch("{% url 'Utilisateur:liker_publication' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken'),
                },
                body: JSON.stringify({ publication_id: publicationId }),
            })
                .then(response => response.json())
                .then(data => {
                    const likesCountElement = this.closest('.publication').querySelector('.likes-count');

                    if (data.liked) {
                        this.classList.add('liked');
                        likesCountElement.textContent = parseInt(likesCountElement.textContent) + 1;
                    } else {
                        this.classList.remove('liked');
                        likesCountElement.textContent = parseInt(likesCountElement.textContent) - 1;
                    }
                });
        });
    });




    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.publication').forEach(publication => {
            const commentButton = publication.querySelector(`[id^="comment-button"]`);
            const publicationId = commentButton.getAttribute('data-publicationafficher-id');

            const commentsSection = publication.querySelector(`#comments-section-${publicationId}`);
            const commentForm = publication.querySelector(`#commentaire-form-${publicationId}`);

            commentsSection.setAttribute('data-visible', 'false');

            commentButton.addEventListener('click', function() {
                const isVisible = commentsSection.getAttribute('data-visible') === 'true';

                if (isVisible) {
                    commentsSection.style.display = 'none';
                    commentsSection.setAttribute('data-visible', 'false');
                    clearInterval(intervalId);
                } else {
                    commentsSection.style.display = 'block';
                    commentsSection.setAttribute('data-visible', 'true');
                }
            });

            commentForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const texte = commentForm.querySelector(`#commentaire-input-${publicationId}`).value;

                if (texte.trim() === '') {
                    console.log('Le commentaire ne peut pas √™tre vide');
                    return;
                }
                fetch("{% url 'Utilisateur:commenter_publication' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                    },
                    body: JSON.stringify({
                        publication_id: publicationId,
                        texte: texte
                    }),
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.utilisateur_nom && data.utilisateur_prenom && data.texte) {
                            commentForm.querySelector(`#commentaire-input-${publicationId}`).value = '';
                        } else {
                            console.error('Erreur lors de l\'ajout du commentaire :', data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Erreur :', error);
                    });
            });
        });
    });



    function getCookie(name) {
        const cookieValue = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
        return cookieValue ? decodeURIComponent(cookieValue[2]) : null;
    }
</script>
<script>
function createEventSource() {
    const eventSource = new EventSource("{% url 'Utilisateur:comment_sse' %}");
    eventSource.onmessage = function(event) {
        const newComment = JSON.parse(event.data);
        const commentsContainer = document.getElementById(`comments-container-${newComment.publication_id}`);
        if (commentsContainer) {
            const newCommentDiv = document.createElement('div');
            newCommentDiv.classList.add('comment');
            newCommentDiv.innerHTML = `
                <p class="comment-user">${newComment.utilisateur}</p>
                <p class="comment-text">${newComment.texte}</p>
                <p class="comment-time">${newComment.date_comment}</p>
            `;
            commentsContainer.appendChild(newCommentDiv);
            commentsContainer.scrollTop = commentsContainer.scrollHeight;
        } else {
            console.error("Element not found: comments-container-" + newComment.publication_id);
        }
    };
}
createEventSource();
function loadInitialComments() {
    document.querySelectorAll('.comments-section').forEach(commentsSection => {
        const publicationId = commentsSection.id.split('-')[2];
        console.log(`Traitement de la publication ID: ${publicationId}`);
        const commentsContainer = document.getElementById(`comments-container-${publicationId}`);
        if (!commentsContainer) {
            console.error(`Conteneur de commentaires introuvable pour la publication ID ${publicationId}`);
            return;
        }
        const url = commentsSection.dataset.url;
        console.log(url);
        fetch(url)
            .then(response => response.json())
            .then(comments => {
                commentsContainer.innerHTML = '';
                comments.forEach(comment => {
                    const commentDiv = document.createElement('div');
                    commentDiv.classList.add('comment');
                    commentDiv.innerHTML = `
                        <p class="comment-user">User ${comment.utilisateur}</p>
                        <p class="comment-text">${comment.texte}</p>
                        <p class="comment-time">${new Date(comment.date_comment).toLocaleString()}</p>
                    `;
                    commentsContainer.appendChild(commentDiv);
                });
                commentsContainer.scrollTop = commentsContainer.scrollHeight;
            })
            .catch(error => {
                console.error(`Erreur lors du chargement des commentaires pour la publication ID ${publicationId}:`, error);
            });
    });
}
document.addEventListener('DOMContentLoaded', loadInitialComments);
</script>

<script>
    function nombreCommentaire() {
        $('.publication').each(function() {
            var actionsSection = $(this).find('.publication-actions');
            var commentButton = actionsSection.find('.action-button#comment-button');
            if (commentButton.length > 0) {
                var publicationId = commentButton.data('publicationafficher-id');
                var commentCountSpan = actionsSection.find('#comment-count-' + publicationId);
                if (commentCountSpan.length > 0) {
                    $.ajax({
                        url: "{% url 'Utilisateur:get_comment_count' %}",
                        type: 'GET',
                        data: {
                            publication_id: publicationId
                        },
                        success: function(data) {
                            commentCountSpan.text(data.comment_count);

                        },
                        error: function(xhr, status, error) {
                            console.error("Erreur lors de la r√©cup√©ration du nombre de commentaires : " + error);
                        }
                    });
                } else {
                    console.error('Aucun √©l√©ment `comment-count-' + publicationId + '` trouv√©');
                }
            } else {
                console.error('Aucun bouton de commentaire trouv√©');
            }
        });
    }
    setInterval(nombreCommentaire, 2000);
</script>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register("{% static 'accueil_utilisateur/js/service-worker.js' %}")
                .then((registration) => {
                    console.log('Service worker registered with scope:', registration.scope, );

                })
                .catch((error) => {
                    console.error('Service worker registration failed:', error);
                });
        });
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const publicationActionIcon = document.getElementById('publication-action-icon');
        const publicationSection = document.getElementById('publicationSection');
        const backgroundOptions = document.querySelectorAll('.backgroundOption');
        const couleurPreview = document.getElementById('couleurPreview');
        const texteInput = document.getElementById('texteInput');
        const textePreview = document.getElementById('textePreview');
        const couleurFondHidden = document.getElementById('couleurFondHidden');
        const blurContainer = document.getElementById('Acceuil');
        const closeIcon = document.querySelector('#publicationSection i.bi-x-circle-fill');

        publicationActionIcon.addEventListener('click', () => {
            if (publicationSection.style.display === 'none') {
                publicationSection.style.display = 'block';
                blurContainer.classList.add('blurred');
            } else {
                publicationSection.style.display = 'none';
            }
        });

        backgroundOptions.forEach(option => {
            option.addEventListener('click', () => {
                const backgroundImage = option.dataset.value;
                document.getElementById('preview').style.backgroundImage = backgroundImage;
                couleurFondHidden.value = backgroundImage;
            });
        });
        closeIcon.addEventListener('click', () => {
            publicationSection.style.display = 'none';
            blurContainer.classList.remove('blurred');
        });
        texteInput.addEventListener('input', updatePreview);
        function updatePreview() {
            const enteredText = texteInput.value;
            textePreview.textContent = enteredText;
        }
    });
</script>

<script>
    document.getElementById('emojiButton').addEventListener('click', function() {
        var emojiPanel = document.getElementById('emojiPanel');
        if (emojiPanel.style.display === 'none') {
            emojiPanel.style.display = 'block';
        } else {
            emojiPanel.style.display = 'none';
        }
    });

    function insertEmoji(emoji) {
        var textarea = document.getElementById('texteInput');
        var cursorPosition = textarea.selectionStart;
        var textBeforeCursor = textarea.value.substring(0, cursorPosition);
        var textAfterCursor = textarea.value.substring(cursorPosition);
        textarea.value = textBeforeCursor + emoji + textAfterCursor;
        updatePreview();
    }
    function updatePreview() {
        var selectedColor = couleurFondInput.value;
        var enteredText = texteInput.value;
        couleurPreview.style.backgroundColor = selectedColor;
        textePreview.textContent = enteredText;
    }
</script>
<script>
    let profileDropdownList = document.querySelector(".profile-dropdown-list");
    let btn = document.querySelector(".profile-dropdown-btn");

    let classList = profileDropdownList.classList;

    const toggle = () => classList.toggle("active");

    window.addEventListener("click", function (e) {
        if (!btn.contains(e.target)) classList.remove("active");
    });
</script>
<script>
    function deconnexion() {
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = '{% url 'Model:Deconnexion' %}';
        var csrf = document.createElement('input');
        csrf.type = 'hidden';
        csrf.name = 'csrfmiddlewaretoken';
        csrf.value = '{{ csrf_token }}';
        form.appendChild(csrf);
        document.body.appendChild(form);
        form.submit();
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.querySelector('.publier_text_form');
        const submitButton = document.getElementById('publicationButton');
        form.addEventListener('submit', (event) => {
            event.preventDefault();
            submitButton.disabled = true;
            submitButton.classList.add('loading');
            form.submit();
        });
    });


    document.addEventListener('DOMContentLoaded', () => {
        const form = document.querySelector('.publish-form');
        const submitButton = document.getElementById('publishFormButton');
        form.addEventListener('submit', (event) => {
            event.preventDefault();
            submitButton.disabled = true;
            submitButton.classList.add('loading');
            form.submit();
        });
    });
</script>
</body>
</html>